<!DOCTYPE html>
<html>
<head>
  <title>Finanzas Personales ‚Äì Registro, Dashboard y Tabla</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .view { display: none; }
    .visible { display: block; }
    label { display: block; margin-top: 10px; }
    input, select, textarea { width: 100%; padding: 5px; margin-top: 5px; }
    button { margin-top: 10px; padding: 8px 16px; }
    .toggle-buttons { margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>

  <h1>Finanzas Personales</h1>

  <div class="toggle-buttons">
    <button onclick="mostrarVista('registro')">üìù Registrar Gasto</button>
    <button onclick="mostrarVista('dashboard')">üìä Ver Dashboard</button>
    <button onclick="mostrarVista('tabla')">üìã Ver y Editar Registros</button>
    <button onclick="descargarCSV()">üì• Exportar CSV</button>
  </div>

  <!-- Vista de Registro -->
  <div id="vista-registro" class="view visible">
    <h2>Registrar nuevo gasto o ingreso</h2>
    <form id="formulario">
      <label>Fecha <input type="date" name="fecha" required></label>
      <label>Monto <input type="number" name="monto" step="0.01" required></label>
      <label>Tipo
        <select name="tipo" required>
          <option value="Gasto">Gasto</option>
          <option value="Ingreso">Ingreso</option>
          <option value="Ahorro/Inversion">Ahorro/Inversion</option>
        </select>
      </label>
      <label>Tarjeta <input type="text" name="tarjeta"></label>
      <label>Concepto <input type="text" name="concepto"></label>
      <label>Tienda <input type="text" name="tienda"></label>
      <label>Categor√≠a <input type="text" name="categoria"></label>
      <label>MSI <input type="number" name="msi"></label>
      <label>Total MSI <input type="number" name="total_msi"></label>
      <label>Fecha Inicio Corte <input type="date" name="fecha_inicio_corte"></label>
      <label>Fecha Corte <input type="date" name="fecha_corte"></label>
      <label>Fecha Pago <input type="date" name="fecha_pago"></label>
      <label>Notas <textarea name="notas" rows="2"></textarea></label>

      <button type="submit">‚ûï Agregar</button>
    </form>
  </div>

  <!-- Vista de Dashboard -->
  <div id="vista-dashboard" class="view">
    <h2>Dashboard (en construcci√≥n)</h2>
    <p>Pr√≥ximamente ver√°s aqu√≠ tu resumen financiero visualizado.</p>
    <ul id="lista-registros"></ul>
  </div>

  <!-- Vista tipo Excel -->
  <div id="vista-tabla" class="view">
    <h2>Ver, Editar y Borrar Registros</h2>
    <table id="tabla-datos">
      <thead id="tabla-encabezado"></thead>
      <tbody id="tabla-cuerpo"></tbody>
    </table>
  </div>

  <script>
    const STORAGE_KEY = "finanzas_datos";

    function mostrarVista(id) {
      document.querySelectorAll(".view").forEach(div => div.classList.remove("visible"));
      document.getElementById("vista-" + id).classList.add("visible");
      if (id === "dashboard") mostrarRegistros();
      if (id === "tabla") renderTabla();
    }

    function obtenerDatos() {
      return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    }

    function guardarDatos(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    document.getElementById("formulario").addEventListener("submit", function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const nuevo = {};
      formData.forEach((value, key) => { nuevo[key] = value; });
      const datos = obtenerDatos();
      datos.push(nuevo);
      guardarDatos(datos);
      alert("Registro agregado.");
      e.target.reset();
    });

    function mostrarRegistros() {
      const lista = document.getElementById("lista-registros");
      const datos = obtenerDatos();
      lista.innerHTML = "";
      datos.forEach((item, i) => {
        const li = document.createElement("li");
        li.textContent = `${item.fecha} | ${item.tipo} | $${item.monto} | ${item.categoria}`;
        lista.appendChild(li);
      });
    }

    function renderTabla() {
      const datos = obtenerDatos();
      const tablaEncabezado = document.getElementById("tabla-encabezado");
      const tablaCuerpo = document.getElementById("tabla-cuerpo");
      tablaEncabezado.innerHTML = "";
      tablaCuerpo.innerHTML = "";

      if (!datos.length) return;

      const encabezados = Object.keys(datos[0]);
      const filaEncabezado = "<tr>" + encabezados.map(h => `<th>${h}</th>`).join("") + "<th>Acci√≥n</th></tr>";
      tablaEncabezado.innerHTML = filaEncabezado;

      datos.forEach((fila, index) => {
        const celdas = encabezados.map(campo =>
          `<td contenteditable="true" oninput="actualizarCampo(${index}, '${campo}', this.innerText)">${fila[campo] || ""}</td>`).join("");
        const botonEliminar = `<td><button onclick="eliminarRegistro(${index})">üóëÔ∏è</button></td>`;
        tablaCuerpo.innerHTML += `<tr>${celdas}${botonEliminar}</tr>`;
      });
    }

    function actualizarCampo(index, campo, valor) {
      const datos = obtenerDatos();
      datos[index][campo] = valor;
      guardarDatos(datos);
    }

    function eliminarRegistro(index) {
      const datos = obtenerDatos();
      if (confirm("¬øEst√°s seguro de que deseas eliminar este registro?")) {
        datos.splice(index, 1);
        guardarDatos(datos);
        renderTabla();
      }
    }

    function descargarCSV() {
      const datos = obtenerDatos();
      if (!datos.length) return alert("No hay datos para exportar.");
      const encabezado = Object.keys(datos[0]);
      const filas = datos.map(obj => encabezado.map(key => `"${obj[key] || ''}"`).join(","));
      const csv = [encabezado.join(","), ...filas].join("\\n");
      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.setAttribute("href", url);
      link.setAttribute("download", "finanzas.csv");
      link.style.display = "none";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>

</body>
</html>
