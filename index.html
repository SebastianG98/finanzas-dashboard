<!DOCTYPE html>
<html>
<head>
  <title>Finanzas Personales ‚Äì Registro y Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .view { display: none; }
    .visible { display: block; }
    label { display: block; margin-top: 10px; }
    input, select, textarea { width: 100%; padding: 5px; margin-top: 5px; }
    button { margin-top: 20px; padding: 10px 20px; }
    .toggle-buttons { margin-bottom: 20px; }
  </style>
</head>
<body>

  <h1>Finanzas Personales</h1>

  <div class="toggle-buttons">
    <button onclick="mostrarVista('registro')">üìù Registrar Gasto</button>
    <button onclick="mostrarVista('dashboard')">üìä Ver Dashboard</button>
    <button onclick="descargarCSV()">üì• Exportar CSV</button>
  </div>

  <!-- Vista de Registro -->
  <div id="vista-registro" class="view visible">
    <h2>Registrar nuevo gasto o ingreso</h2>
    <form id="formulario">
      <label>Fecha <input type="date" name="fecha" required></label>
      <label>Monto <input type="number" name="monto" step="0.01" required></label>
      <label>Tipo
        <select name="tipo" required>
          <option value="Gasto">Gasto</option>
          <option value="Ingreso">Ingreso</option>
          <option value="Ahorro/Inversion">Ahorro/Inversion</option>
        </select>
      </label>
      <label>Tarjeta <input type="text" name="tarjeta"></label>
      <label>Concepto <input type="text" name="concepto"></label>
      <label>Tienda <input type="text" name="tienda"></label>
      <label>Categor√≠a <input type="text" name="categoria"></label>
      <label>MSI <input type="number" name="msi"></label>
      <label>Total MSI <input type="number" name="total_msi"></label>
      <label>Fecha Inicio Corte <input type="date" name="fecha_inicio_corte"></label>
      <label>Fecha Corte <input type="date" name="fecha_corte"></label>
      <label>Fecha Pago <input type="date" name="fecha_pago"></label>
      <label>Notas <textarea name="notas" rows="2"></textarea></label>

      <button type="submit">‚ûï Agregar</button>
    </form>
  </div>

  <!-- Vista de Dashboard -->
  <div id="vista-dashboard" class="view">
    <h2>Dashboard (en construcci√≥n)</h2>
    <p>Pr√≥ximamente ver√°s aqu√≠ tu resumen financiero visualizado.</p>
    <ul id="lista-registros"></ul>
  </div>

  <script>
    const STORAGE_KEY = "finanzas_datos";

    function mostrarVista(id) {
      document.getElementById("vista-registro").classList.remove("visible");
      document.getElementById("vista-dashboard").classList.remove("visible");
      document.getElementById("vista-" + id).classList.add("visible");
      if (id === "dashboard") mostrarRegistros();
    }

    function obtenerDatos() {
      return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    }

    function guardarDatos(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    document.getElementById("formulario").addEventListener("submit", function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const nuevo = {};
      formData.forEach((value, key) => { nuevo[key] = value; });
      const datos = obtenerDatos();
      datos.push(nuevo);
      guardarDatos(datos);
      alert("Registro agregado.");
      e.target.reset();
    });

    function mostrarRegistros() {
      const lista = document.getElementById("lista-registros");
      const datos = obtenerDatos();
      lista.innerHTML = "";
      datos.forEach((item, i) => {
        const li = document.createElement("li");
        li.textContent = `${item.fecha} | ${item.tipo} | $${item.monto} | ${item.categoria}`;
        lista.appendChild(li);
      });
    }

    function descargarCSV() {
      const datos = obtenerDatos();
      if (!datos.length) return alert("No hay datos para exportar.");
      const encabezado = Object.keys(datos[0]);
      const filas = datos.map(obj => encabezado.map(key => `"${obj[key] || ''}"`).join(","));
      const csv = [encabezado.join(","), ...filas].join("\\n");
      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.setAttribute("href", url);
      link.setAttribute("download", "finanzas.csv");
      link.style.display = "none";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>

</body>
</html>
